// Prisma schema for NeurallEmpire Central Database
// Handles: Authentication, Organizations, Product Access, Subscriptions

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// Organizations (Multi-tenant structure)
model Organization {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name      String
  slug      String   @unique
  ownerId   String   @map("owner_id") @db.Uuid
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  productAccess ProductAccess[]
  subscriptions Subscription[]

  @@map("organizations")
}

// Product Access (Who can access which product in which org)
model ProductAccess {
  id             String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId         String   @map("user_id") @db.Uuid
  organizationId String   @map("organization_id") @db.Uuid
  productSlug    String   @map("product_slug") // 'platform', 'vendornet', etc.
  role           Role
  createdAt      DateTime @default(now()) @map("created_at") @db.Timestamptz(6)

  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([userId, organizationId, productSlug])
  @@index([userId])
  @@index([organizationId])
  @@map("product_access")
}

// Subscriptions (Stripe billing)
model Subscription {
  id                   String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  organizationId       String             @map("organization_id") @db.Uuid
  productSlug          String             @map("product_slug")
  stripeSubscriptionId String?            @map("stripe_subscription_id")
  stripeCustomerId     String?            @map("stripe_customer_id")
  plan                 SubscriptionPlan
  status               SubscriptionStatus
  trialEndsAt          DateTime?          @map("trial_ends_at") @db.Timestamptz(6)
  currentPeriodEnd     DateTime?          @map("current_period_end") @db.Timestamptz(6)
  createdAt            DateTime           @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt            DateTime           @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
  @@index([stripeSubscriptionId])
  @@map("subscriptions")
}

// Enums
enum Role {
  owner
  admin
  member
  viewer
}

enum SubscriptionPlan {
  free
  starter
  pro
  enterprise
}

enum SubscriptionStatus {
  active
  canceled
  past_due
  trialing
}

// CMS Models for Website Content

// Blog Posts
model BlogPost {
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title          String
  slug           String    @unique
  content        String    @db.Text
  excerpt        String?   @db.Text
  featuredImage  String?   @map("featured_image")
  authorId       String    @map("author_id") @db.Uuid
  category       String?
  tags           String[]
  published      Boolean   @default(false)
  publishedAt    DateTime? @map("published_at") @db.Timestamptz(6)
  metaTitle      String?   @map("meta_title")
  metaDescription String?  @map("meta_description")
  createdAt      DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt      DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  @@index([slug])
  @@index([published])
  @@index([category])
  @@map("blog_posts")
}

// Case Studies
model CaseStudy {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title         String
  slug          String   @unique
  clientName    String   @map("client_name")
  clientLogo    String?  @map("client_logo")
  industry      String
  productUsed   String   @map("product_used")
  challenge     String   @db.Text
  solution      String   @db.Text
  results       Json?
  testimonial   String?  @db.Text
  featuredImage String?  @map("featured_image")
  published     Boolean  @default(false)
  featured      Boolean  @default(false)
  createdAt     DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt     DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  @@index([slug])
  @@index([industry])
  @@index([published])
  @@map("case_studies")
}

// Client Testimonials
model Testimonial {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clientName    String   @map("client_name")
  clientRole    String   @map("client_role")
  clientCompany String   @map("client_company")
  clientAvatar  String?  @map("client_avatar")
  content       String   @db.Text
  rating        Int      @default(5)
  featured      Boolean  @default(false)
  productUsed   String?  @map("product_used")
  createdAt     DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt     DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  @@index([featured])
  @@map("testimonials")
}

// Products (for dynamic product management)
model Product {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name            String
  slug            String   @unique
  description     String   @db.Text
  longDescription String?  @map("long_description") @db.Text
  features        Json?
  pricing         Json?
  icon            String?
  color           String?
  category        String?
  status          ProductStatus @default(live)
  url             String?
  demoUrl         String?  @map("demo_url")
  order           Int      @default(0)
  createdAt       DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt       DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  @@index([slug])
  @@index([status])
  @@map("products")
}

enum ProductStatus {
  live
  beta
  coming_soon
}

// Contact Form Submissions
model ContactSubmission {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name         String
  email        String
  company      String?
  phone        String?
  companySize  String?  @map("company_size")
  timeline     String?
  message      String   @db.Text
  isRead       Boolean  @default(false) @map("is_read")
  isArchived   Boolean  @default(false) @map("is_archived")
  notes        String?  @db.Text
  createdAt    DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt    DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  @@index([isRead])
  @@index([createdAt])
  @@map("contact_submissions")
}

// Services (for AI Systems website)
model Service {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title           String
  slug            String   @unique
  shortDesc       String   @map("short_desc") @db.Text
  problemStatement String  @map("problem_statement") @db.Text
  solutionDesc    String   @map("solution_desc") @db.Text
  features        String[]
  whoItHelps      String   @map("who_it_helps") @db.Text
  typicalTimeline String   @map("typical_timeline")
  icon            String?
  image           String?
  order           Int      @default(0)
  isPublished     Boolean  @default(true) @map("is_published")
  metaTitle       String?  @map("meta_title")
  metaDescription String?  @map("meta_description")
  createdAt       DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt       DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  @@index([slug])
  @@index([order])
  @@map("services")
}

// Newsletter Subscribers
model NewsletterSubscriber {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email       String   @unique
  name        String?
  isActive    Boolean  @default(true) @map("is_active")
  tags        String[]
  subscribedAt DateTime @default(now()) @map("subscribed_at") @db.Timestamptz(6)
  unsubscribedAt DateTime? @map("unsubscribed_at") @db.Timestamptz(6)

  @@index([email])
  @@index([isActive])
  @@map("newsletter_subscribers")
}

// Site Settings
model SiteSettings {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  key         String   @unique
  value       String   @db.Text
  description String?
  updatedAt   DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  @@map("site_settings")
}

// Page Views (Analytics)
model PageView {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  path      String
  referrer  String?
  userAgent String?  @map("user_agent")
  ipAddress String?  @map("ip_address")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)

  @@index([path])
  @@index([createdAt])
  @@map("page_views")
}
